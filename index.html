<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>六爻起卦工具（完整版）</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', '微軟正黑體', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #8B4513;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .section h3 {
            margin-top: 0;
            color: #8B4513;
            border-bottom: 2px solid #8B4513;
            padding-bottom: 5px;
        }
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        .input-item {
            flex: 1;
            min-width: 120px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        textarea {
            height: 60px;
            resize: vertical;
        }
        .hexagram-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        .hexagram-table th, .hexagram-table td {
            border: 1px solid #333;
            padding: 6px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
        }
        .hexagram-table th {
            background-color: #8B4513;
            color: white;
        }
        .yao-line {
            font-size: 16px;
            font-weight: bold;
        }
        .yang { color: #FF0000; }
        .yin { color: #0000FF; }
        .dong-yao { 
            background-color: #FFE4B5 !important;
            color: #8B0000;
        }
        .kong-wang {
            background-color: #E6E6FA !important;
        }
        .fu-shen {
            font-size: 10px;
            color: #666;
            font-style: italic;
        }
        .bian-info {
            font-size: 11px;
            color: #800080;
        }
        .buttons {
            text-align: center;
            margin-top: 20px;
        }
        button {
            background-color: #8B4513;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover {
            background-color: #A0522D;
        }
        .prompt-output {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .copy-btn {
            background-color: #4CAF50;
            margin-top: 10px;
        }
        .copy-btn:hover {
            background-color: #45a049;
        }
        .coin-section {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .coin-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .coin-input label {
            min-width: 80px;
            margin-bottom: 0;
        }
        .coin-buttons {
            display: flex;
            gap: 5px;
        }
        .coin-btn {
            padding: 5px 10px;
            font-size: 12px;
            margin: 0;
        }
        .auto-btn {
            background-color: #FF6347;
            margin-left: 10px;
        }
        .auto-btn:hover {
            background-color: #FF4500;
        }
        .gua-type {
            color: #008B8B;
            font-weight: bold;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>六爻起卦工具（完整版）</h1>
        
            <div class="section">
              <h3>四柱信息</h3>
              <div class="input-group">
                <div class="input-item">
                  <label for="year">年柱:</label>
                  <select id="year"></select>
                </div>
                <div class="input-item">
                  <label for="month">月柱:</label>
                  <select id="month"></select>
                </div>
                <div class="input-item">
                  <label for="day">日柱:</label>
                  <select id="day"></select>
                </div>
                <div class="input-item">
                  <label for="hour">時柱:</label>
                  <select id="hour"></select>
                </div>
              </div>
            </div>

        <div class="section coin-section">
            <h3>投擲三錢起卦（按古法：乾隆通寶）</h3>
            <p style="font-size: 12px; color: #666;">
                字面為正（陽），背面為陰。兩字一背為少陽（—），兩背一字為少陰（- -），三背為老陽變爻（—O），三字為老陰變爻（- -X）
            </p>
            
        <!-- 第六次（上爻） -->
        <div class="coin-input">
          <label>第六次（上爻）:</label>
          <div class="coin-buttons">
            <button class="coin-btn" onclick="setCoinResult(6, '字字字')">三字(老陰)</button>
            <button class="coin-btn" onclick="setCoinResult(6, '字字背')">兩字一背(少陽)</button>
            <button class="coin-btn" onclick="setCoinResult(6, '字背背')">一字兩背(少陰)</button>
            <button class="coin-btn" onclick="setCoinResult(6, '背背背')">三背(老陽)</button>
          </div>
          <span id="coin6-result"></span>
        </div>

        <!-- 第五次（五爻） -->
        <div class="coin-input">
          <label>第五次（五爻）:</label>
          <div class="coin-buttons">
            <button class="coin-btn" onclick="setCoinResult(5, '字字字')">三字(老陰)</button>
            <button class="coin-btn" onclick="setCoinResult(5, '字字背')">兩字一背(少陽)</button>
            <button class="coin-btn" onclick="setCoinResult(5, '字背背')">一字兩背(少陰)</button>
            <button class="coin-btn" onclick="setCoinResult(5, '背背背')">三背(老陽)</button>
          </div>
          <span id="coin5-result"></span>
        </div>

        <!-- 第四次（四爻） -->
        <div class="coin-input">
          <label>第四次（四爻）:</label>
          <div class="coin-buttons">
            <button class="coin-btn" onclick="setCoinResult(4, '字字字')">三字(老陰)</button>
            <button class="coin-btn" onclick="setCoinResult(4, '字字背')">兩字一背(少陽)</button>
            <button class="coin-btn" onclick="setCoinResult(4, '字背背')">一字兩背(少陰)</button>
            <button class="coin-btn" onclick="setCoinResult(4, '背背背')">三背(老陽)</button>
          </div>
          <span id="coin4-result"></span>
        </div>

        <!-- 第三次（三爻） -->
        <div class="coin-input">
          <label>第三次（三爻）:</label>
          <div class="coin-buttons">
            <button class="coin-btn" onclick="setCoinResult(3, '字字字')">三字(老陰)</button>
            <button class="coin-btn" onclick="setCoinResult(3, '字字背')">兩字一背(少陽)</button>
            <button class="coin-btn" onclick="setCoinResult(3, '字背背')">一字兩背(少陰)</button>
            <button class="coin-btn" onclick="setCoinResult(3, '背背背')">三背(老陽)</button>
          </div>
          <span id="coin3-result"></span>
        </div>

        <!-- 第二次（二爻） -->
        <div class="coin-input">
          <label>第二次（二爻）:</label>
          <div class="coin-buttons">
            <button class="coin-btn" onclick="setCoinResult(2, '字字字')">三字(老陰)</button>
            <button class="coin-btn" onclick="setCoinResult(2, '字字背')">兩字一背(少陽)</button>
            <button class="coin-btn" onclick="setCoinResult(2, '字背背')">一字兩背(少陰)</button>
            <button class="coin-btn" onclick="setCoinResult(2, '背背背')">三背(老陽)</button>
          </div>
          <span id="coin2-result"></span>
        </div>

        <!-- 第一次（初爻） -->
        <div class="coin-input">
          <label>第一次（初爻）:</label>
          <div class="coin-buttons">
            <button class="coin-btn" onclick="setCoinResult(1, '字字字')">三字(老陰)</button>
            <button class="coin-btn" onclick="setCoinResult(1, '字字背')">兩字一背(少陽)</button>
            <button class="coin-btn" onclick="setCoinResult(1, '字背背')">一字兩背(少陰)</button>
            <button class="coin-btn" onclick="setCoinResult(1, '背背背')">三背(老陽)</button>
          </div>
          <span id="coin1-result"></span>
        </div>

            
            <button class="auto-btn" onclick="autoThrowCoins()">自動投擲六次</button>
        </div>

        <!-- 數字起卦 -->
        <div class="section">
          <h3>數字起卦（免搖錢）</h3>
          <div class="input-group">
            <!-- 方法一：一個數字 -->
            <div class="input-item">
              <label for="num-one">方法一：報一個數字</label>
              <input id="num-one" type="number" placeholder="例如：3">
              <button class="coin-btn" onclick="startByOne()">用方法一起卦</button>
              <div style="font-size:12px;color:#666;margin-top:4px">
                上卦=此數÷8取餘(零當八)；下卦=時辰數(子=1…亥=12)÷8取餘；動爻=(此數+時辰數)÷6取餘(零當六)
              </div>
            </div>

            <!-- 方法二：兩個數字 -->
            <div class="input-item">
              <label>方法二：報兩個數字</label>
              <div style="display:flex;gap:6px">
                <input id="num-two-a" type="number" placeholder="第一個（上卦）">
                <input id="num-two-b" type="number" placeholder="第二個（下卦）">
              </div>
              <button class="coin-btn" onclick="startByTwo()">用方法二起卦</button>
              <div style="font-size:12px;color:#666;margin-top:4px">
                上卦=第一個÷8；下卦=第二個÷8；動爻=(兩數相加)÷6（零當六）
              </div>
            </div>

            <!-- 方法三：一組多位數 -->
            <div class="input-item" style="flex:2">
              <label for="num-many">方法三：報一組多位數</label>
              <input id="num-many" type="text" placeholder="例如：789 或 1234">
              <button class="coin-btn" onclick="startByMany()">用方法三起卦</button>
              <div style="font-size:12px;color:#666;margin-top:4px">
                奇位數：分段法（首位 / 其餘）；偶位數：平分法（前半和 / 後半和）。兩段各÷8取餘；動爻=全數逐位相加÷6（零當六）
              </div>
            </div>
          </div>
        </div>


        <div class="section">
            <h3>問事內容</h3>
            <textarea id="question" placeholder="請輸入所問何事..."></textarea>
        </div>

        <div class="buttons">
            <button onclick="generateTable()">生成完整六爻表</button>
            <button onclick="exportPrompt()">導出AI分析Prompt</button>
        </div>

        <div id="hexagram-display"></div>
        <div id="prompt-display"></div>
    </div>

    <script>
        // 卦象數據（更新世應位置）
        const guaData = {
            // 乾宮
            '111111': {name: '乾', fullName: '乾為天', shiYing: [6,3], type: ''},
            '111110': {name: '姤', fullName: '天風姤', shiYing: [1,4], type: ''},
            '111100': {name: '遯', fullName: '天山遯', shiYing: [2,5], type: ''},
            '111000': {name: '否', fullName: '天地否', shiYing: [3,6], type: '六沖'},
            '110000': {name: '觀', fullName: '風地觀', shiYing: [4,1], type: ''},
            '100000': {name: '剝', fullName: '山地剝', shiYing: [5,2], type: ''},
            '101000': {name: '晉', fullName: '火地晉', shiYing: [4,1], type: '游魂'},
            '101111': {name: '大有', fullName: '火天大有', shiYing: [3,6], type: '歸魂'},
            
            // 震宮
            '001001': {name: '震', fullName: '震為雷', shiYing: [6,3], type: ''},
            '001000': {name: '豫', fullName: '雷地豫', shiYing: [1,4], type: ''},
            '001010': {name: '解', fullName: '雷水解', shiYing: [2,5], type: ''},
            '001110': {name: '恆', fullName: '雷風恆', shiYing: [3,6], type: '六合'},
            '000110': {name: '升', fullName: '地風升', shiYing: [4,1], type: ''},
            '010110': {name: '井', fullName: '水風井', shiYing: [5,2], type: ''},
            '011110': {name: '大過', fullName: '澤風大過', shiYing: [4,1], type: '游魂'},
            '011001': {name: '隨', fullName: '澤雷隨', shiYing: [3,6], type: '歸魂六沖'},
            
            // 坎宮
            '010010': {name: '坎', fullName: '坎為水', shiYing: [6,3], type: ''},
            '010011': {name: '節', fullName: '水澤節', shiYing: [1,4], type: ''},
            '010001': {name: '屯', fullName: '水雷屯', shiYing: [2,5], type: ''},
            '010101': {name: '既濟', fullName: '水火既濟', shiYing: [3,6], type: '六合'},
            '011101': {name: '革', fullName: '澤火革', shiYing: [4,1], type: ''},
            '001101': {name: '豐', fullName: '雷火豐', shiYing: [5,2], type: ''},
            '000101': {name: '明夷', fullName: '地火明夷', shiYing: [4,1], type: '游魂'},
            '000010': {name: '師', fullName: '地水師', shiYing: [3,6], type: '歸魂'},
            
            // 艮宮
            '100100': {name: '艮', fullName: '艮為山', shiYing: [6,3], type: ''},
            '100101': {name: '賁', fullName: '山火賁', shiYing: [1,4], type: ''},
            '100111': {name: '大畜', fullName: '山天大畜', shiYing: [2,5], type: ''},
            '100011': {name: '損', fullName: '山澤損', shiYing: [3,6], type: '六合'},
            '101011': {name: '睽', fullName: '火澤睽', shiYing: [4,1], type: ''},
            '111011': {name: '履', fullName: '天澤履', shiYing: [5,2], type: ''},
            '110011': {name: '中孚', fullName: '風澤中孚', shiYing: [4,1], type: '游魂'},
            '110100': {name: '漸', fullName: '風山漸', shiYing: [3,6], type: '歸魂六合'},
            
            // 坤宮
            '000000': {name: '坤', fullName: '坤為地', shiYing: [6,3], type: ''},
            '000001': {name: '復', fullName: '地雷復', shiYing: [1,4], type: ''},
            '000011': {name: '臨', fullName: '地澤臨', shiYing: [2,5], type: ''},
            '000111': {name: '泰', fullName: '地天泰', shiYing: [3,6], type: '六沖'},
            '001111': {name: '大壯', fullName: '雷天大壯', shiYing: [4,1], type: ''},
            '011111': {name: '夬', fullName: '澤天夬', shiYing: [5,2], type: ''},
            '010111': {name: '需', fullName: '水天需', shiYing: [4,1], type: '游魂'},
            '010000': {name: '比', fullName: '水地比', shiYing: [3,6], type: '歸魂'},
            
            // 巽宮
            '110110': {name: '巽', fullName: '巽為風', shiYing: [6,3], type: ''},
            '110111': {name: '小畜', fullName: '風天小畜', shiYing: [1,4], type: ''},
            '110101': {name: '家人', fullName: '風火家人', shiYing: [2,5], type: ''},
            '110001': {name: '益', fullName: '風雷益', shiYing: [3,6], type: '六合'},
            '111001': {name: '無妄', fullName: '天雷無妄', shiYing: [4,1], type: ''},
            '101001': {name: '噬嗑', fullName: '火雷噬嗑', shiYing: [5,2], type: ''},
            '100001': {name: '頤', fullName: '山雷頤', shiYing: [4,1], type: '游魂'},
            '100110': {name: '蠱', fullName: '山風蠱', shiYing: [3,6], type: '歸魂六沖'},
            
            // 離宮
            '101101': {name: '離', fullName: '離為火', shiYing: [6,3], type: ''},
            '101100': {name: '旅', fullName: '火山旅', shiYing: [1,4], type: ''},
            '101110': {name: '鼎', fullName: '火風鼎', shiYing: [2,5], type: ''},
            '101010': {name: '未濟', fullName: '火水未濟', shiYing: [3,6], type: '六合'},
            '100010': {name: '蒙', fullName: '山水蒙', shiYing: [4,1], type: ''},
            '110010': {name: '渙', fullName: '風水渙', shiYing: [5,2], type: ''},
            '111010': {name: '訟', fullName: '天水訟', shiYing: [4,1], type: '游魂六沖'},
            '111101': {name: '同人', fullName: '天火同人', shiYing: [3,6], type: '歸魂'},
            
            // 兌宮
            '011011': {name: '兌', fullName: '兌為澤', shiYing: [6,3], type: ''},
            '011010': {name: '困', fullName: '澤水困', shiYing: [1,4], type: ''},
            '011000': {name: '萃', fullName: '澤地萃', shiYing: [2,5], type: ''},
            '011100': {name: '咸', fullName: '澤山咸', shiYing: [3,6], type: '六合'},
            '010100': {name: '蹇', fullName: '水山蹇', shiYing: [4,1], type: ''},
            '000100': {name: '謙', fullName: '地山謙', shiYing: [5,2], type: ''},
            '001100': {name: '小過', fullName: '雷山小過', shiYing: [4,1], type: '游魂'},
            '001011': {name: '歸妹', fullName: '雷澤歸妹', shiYing: [3,6], type: '歸魂六合'}
        };

        // 六獸
        const liuShou = ['青龍', '朱雀', '勾陳', '螣蛇', '白虎', '玄武'];

        // 天干地支
        const tianGan = ['甲', '乙', '丙', '丁', '戊', '己', '庚', '辛', '壬', '癸'];
        const diZhi = ['子', '丑', '寅', '卯', '辰', '巳', '午', '未', '申', '酉', '戌', '亥'];

        // 五行
        const wuXing = {
            '甲': '木', '乙': '木', '丙': '火', '丁': '火', '戊': '土', '己': '土',
            '庚': '金', '辛': '金', '壬': '水', '癸': '水',
            '子': '水', '丑': '土', '寅': '木', '卯': '木', '辰': '土', '巳': '火',
            '午': '火', '未': '土', '申': '金', '酉': '金', '戌': '土', '亥': '水'
        };

        // ====== 干支下拉：60 甲子生成 & 填充 ======
        const jiaZi60 = Array.from({length: 60}, (_, i) => tianGan[i % 10] + diZhi[i % 12]);

        // —— 生成「按天干分組」的 options ——
        // 甲組：子→戌→申→午→辰→寅；乙組：丑→亥→酉→未→巳→卯 ……
        function buildGroupedGZOptionsHTML() {
          let html = '';
          for (let g = 0; g < 10; g++) {            // 10 個天干
            const gan = tianGan[g];
            html += `<optgroup label="${gan}">`;
            for (let k = 0; k < 6; k++) {           // 每組 6 個
              const zhi = diZhi[(g + 10 * k) % 12]; // 子/戌/申/午/辰/寅 的步進規律
              html += `<option value="${gan + zhi}">${gan + zhi}</option>`;
            }
            html += `</optgroup>`;
          }
          return html;
        }
        function populateGanZhiSelectsGrouped() {
          const optionsHTML = buildGroupedGZOptionsHTML();
          ['year','month','day','hour'].forEach(id => {
            const sel = document.getElementById(id);
            if (sel) sel.innerHTML = optionsHTML;
          });
        }


        // ====== 以現在時間近似計算四柱，並填入下拉 ======
        document.addEventListener('DOMContentLoaded', () => {
          populateGanZhiSelectsGrouped();           // ← 用分組版
        });

        // 六親關係
        function getLiuQin(selfWuXing, targetWuXing) {
            const relations = {
                '木木': '兄弟', '木火': '子孫', '木土': '妻財', '木金': '官鬼', '木水': '父母',
                '火火': '兄弟', '火土': '子孫', '火金': '妻財', '火水': '官鬼', '火木': '父母',
                '土土': '兄弟', '土金': '子孫', '土水': '妻財', '土木': '官鬼', '土火': '父母',
                '金金': '兄弟', '金水': '子孫', '金木': '妻財', '金火': '官鬼', '金土': '父母',
                '水水': '兄弟', '水木': '子孫', '水火': '妻財', '水土': '官鬼', '水金': '父母'
            };
            return relations[selfWuXing + targetWuXing] || '';
        }

        // 八純卦的地支（從初爻到上爻）
        const baChunGuaZhi = {
            '乾': ['子', '寅', '辰', '午', '申', '戌'],  // 乾為天
            '兌': ['巳', '卯', '丑', '亥', '酉', '未'],  // 兌為澤
            '離': ['卯', '丑', '亥', '酉', '未', '巳'],  // 離為火
            '震': ['子', '寅', '辰', '午', '申', '戌'],  // 震為雷
            '巽': ['丑', '亥', '酉', '未', '巳', '卯'],  // 巽為風
            '坎': ['寅', '辰', '午', '申', '戌', '子'],  // 坎為水
            '艮': ['辰', '午', '申', '戌', '子', '寅'],  // 艮為山
            '坤': ['未', '巳', '卯', '丑', '亥', '酉']   // 坤為地
        };

        let coinResults = [null, null, null, null, null, null];

        function setCoinResult(index, result) {
            let yaoType;
            switch(result) {
                case '字字字': yaoType = '老陰'; break;
                case '字字背': yaoType = '少陽'; break;
                case '字背背': yaoType = '少陰'; break;
                case '背背背': yaoType = '老陽'; break;
            }
            
            coinResults[index-1] = yaoType;
            document.getElementById(`coin${index}-result`).innerHTML = 
                `<strong>${result} → ${yaoType}</strong>`;
        }

        function autoThrowCoins() {
            const options = ['字字字', '字字背', '字背背', '背背背'];
            for (let i = 1; i <= 6; i++) {
                const randomResult = options[Math.floor(Math.random() * 4)];
                setCoinResult(i, randomResult);
            }
        }

        function getYaoSymbol(yaoType) {
            switch(yaoType) {
                case '老陽': return '━━━━━━ ○';
                case '少陽': return '━━━━━━';
                case '老陰': return '━━  ━━ ×';
                case '少陰': return '━━  ━━';
                default: return '';
            }
        }

        function getYaoProperty(yaoType) {
            if (yaoType && yaoType.includes('陽')) return '1';
            if (yaoType && yaoType.includes('陰')) return '0';
            return '';
        }

        function isDongYao(yaoType) {
            return yaoType && yaoType.includes('老');
        }

        function getGuaInfo(yaoBinary) {
            return guaData[yaoBinary] || {name: '未知', fullName: '未知卦', shiYing: [1,4], type: ''};
        }

        function getKongWang(dayGan, dayZhi) {
            const ganIndex = tianGan.indexOf(dayGan);
            const zhiIndex = diZhi.indexOf(dayZhi);
            if (ganIndex === -1 || zhiIndex === -1) return ['戌', '亥'];
            
            // 旬空計算
            const xunStart = (zhiIndex - ganIndex + 12) % 12;
            const kongStart = (xunStart + 10) % 12;
            return [diZhi[kongStart], diZhi[(kongStart + 1) % 12]];
        }

        function getGuaGong(binary) {
            // 根據八宮卦序表確定卦宮
            const guaGongMap = {
                // 乾宮
                '111111': '乾', // 乾為天
                '111110': '乾', // 天風姤  
                '111100': '乾', // 天山遯
                '111000': '乾', // 天地否
                '110000': '乾', // 風地觀
                '100000': '乾', // 山地剝
                '101000': '乾', // 火地晉（游魂）
                '101111': '乾', // 火天大有（歸魂）
                
                // 震宮
                '001001': '震', // 震為雷
                '001000': '震', // 雷地豫
                '001010': '震', // 雷水解
                '001110': '震', // 雷風恆
                '000110': '震', // 地風升
                '010110': '震', // 水風井
                '011110': '震', // 澤風大過（游魂）
                '011001': '震', // 澤雷隨（歸魂）
                
                // 坎宮
                '010010': '坎', // 坎為水
                '010011': '坎', // 水澤節
                '010001': '坎', // 水雷屯
                '010101': '坎', // 水火既濟
                '011101': '坎', // 澤火革
                '001101': '坎', // 雷火豐
                '000101': '坎', // 地火明夷（游魂）
                '000010': '坎', // 地水師（歸魂）
                
                // 艮宮
                '100100': '艮', // 艮為山
                '100101': '艮', // 山火賁
                '100111': '艮', // 山天大畜
                '100011': '艮', // 山澤損
                '101011': '艮', // 火澤睽
                '111011': '艮', // 天澤履
                '110011': '艮', // 風澤中孚（游魂）
                '110100': '艮', // 風山漸（歸魂）
                
                // 坤宮
                '000000': '坤', // 坤為地
                '000001': '坤', // 地雷復
                '000011': '坤', // 地澤臨
                '000111': '坤', // 地天泰
                '001111': '坤', // 雷天大壯
                '011111': '坤', // 澤天夬
                '010111': '坤', // 水天需（游魂）
                '010000': '坤', // 水地比（歸魂）
                
                // 巽宮
                '110110': '巽', // 巽為風
                '110111': '巽', // 風天小畜
                '110101': '巽', // 風火家人
                '110001': '巽', // 風雷益
                '111001': '巽', // 天雷無妄
                '101001': '巽', // 火雷噬嗑
                '100001': '巽', // 山雷頤（游魂）
                '100110': '巽', // 山風蠱（歸魂）
                
                // 離宮
                '101101': '離', // 離為火
                '101100': '離', // 火山旅
                '101110': '離', // 火風鼎
                '101010': '離', // 火水未濟
                '100010': '離', // 山水蒙
                '110010': '離', // 風水渙
                '111010': '離', // 天水訟（游魂）
                '111101': '離', // 天火同人（歸魂）
                
                // 兌宮
                '011011': '兌', // 兌為澤
                '011010': '兌', // 澤水困
                '011000': '兌', // 澤地萃
                '011100': '兌', // 澤山咸
                '010100': '兌', // 水山蹇
                '000100': '兌', // 地山謙
                '001100': '兌', // 雷山小過（游魂）
                '001011': '兌'  // 雷澤歸妹（歸魂）
            };
            
            return guaGongMap[binary] || '乾';
        }

        function getGuaGongWuXing(guaGong) {
            const wuXingMap = {
                '乾': '金', '兌': '金', '離': '火', '震': '木',
                '巽': '木', '坎': '水', '艮': '土', '坤': '土'
            };
            return wuXingMap[guaGong] || '金';
        }

        function getZhuangZhi(benGuaBinary) {
            // 分上卦和下卦
            const shangGua = benGuaBinary.substring(0, 3);  // 上三爻（六五四爻）
            const xiaGua = benGuaBinary.substring(3, 6);    // 下三爻（三二初爻）
            
            // 八純卦的納甲規則
            const naJiaMap = {
                '乾': ['子', '寅', '辰', '午', '申', '戌'], // 內卦：子寅辰，外卦：午申戌
                '坤': ['未', '巳', '卯', '丑', '亥', '酉'], // 內卦：未巳卯，外卦：丑亥酉
                '震': ['子', '寅', '辰', '午', '申', '戌'], // 內卦：子寅辰，外卦：午申戌
                '巽': ['丑', '亥', '酉', '未', '巳', '卯'], // 內卦：丑亥酉，外卦：未巳卯
                '坎': ['寅', '辰', '午', '申', '戌', '子'], // 內卦：寅辰午，外卦：申戌子
                '離': ['卯', '丑', '亥', '酉', '未', '巳'], // 內卦：卯丑亥，外卦：酉未巳
                '艮': ['辰', '午', '申', '戌', '子', '寅'], // 內卦：辰午申，外卦：戌子寅
                '兌': ['巳', '卯', '丑', '亥', '酉', '未']  // 內卦：巳卯丑，外卦：亥酉未
            };
            
            // 八卦符號對應
            const guaMap = {
                '111': '乾', '011': '兌', '101': '離', '001': '震',
                '110': '巽', '010': '坎', '100': '艮', '000': '坤'
            };
            
            const shangGuaName = guaMap[shangGua];
            const xiaGuaName = guaMap[xiaGua];
            
            // 獲取納甲地支
            const shangGuaZhi = naJiaMap[shangGuaName];
            const xiaGuaZhi = naJiaMap[xiaGuaName];
            
            // 組合地支：初爻到上爻
            return [
                xiaGuaZhi[0], // 初爻
                xiaGuaZhi[1], // 二爻
                xiaGuaZhi[2], // 三爻
                shangGuaZhi[3], // 四爻
                shangGuaZhi[4], // 五爻
                shangGuaZhi[5]  // 上爻
            ];
        }

        // 獲取伏神
        function getFuShen(benGuaBinary, guaGongWuXing) {
            const guaGong = getGuaGong(benGuaBinary);
            const benGuaZhi = getZhuangZhi(benGuaBinary);
            
            // 獲取卦宮首卦的地支
            const guaGongBinary = getGuaGongBinary(guaGong);
            const guaGongZhi = getZhuangZhi(guaGongBinary);
            
            const fuShenList = [];
            const benGuaLiuQinList = [];
            
            // 先獲取本卦所有的六親
            for (let i = 0; i < 6; i++) {
                const benZhi = benGuaZhi[i];
                const benZhiWuXing = wuXing[benZhi];
                const benLiuQin = getLiuQin(guaGongWuXing, benZhiWuXing);
                benGuaLiuQinList.push(benLiuQin);
            }
            
            // 檢查每個爻位，如果本宮該爻的六親在本卦中不存在，則為伏神
            for (let i = 0; i < 6; i++) {
                const gongZhi = guaGongZhi[i];
                const gongZhiWuXing = wuXing[gongZhi];
                const gongLiuQin = getLiuQin(guaGongWuXing, gongZhiWuXing);
                
                // 檢查這個六親是否在本卦中出現
                if (!benGuaLiuQinList.includes(gongLiuQin)) {
                    // 這個六親沒有出現，伏在對應爻位
                    fuShenList.push({
                        index: i,
                        zhi: gongZhi,
                        wuXing: gongZhiWuXing,
                        liuQin: gongLiuQin
                    });
                }
            }
            
            return fuShenList;
        }

        function getGuaGongBinary(guaGong) {
            const binaryMap = {
                '乾': '111111', '兌': '011011', '離': '101101', '震': '001001',
                '巽': '110110', '坎': '010010', '艮': '100100', '坤': '000000'
            };
            return binaryMap[guaGong] || '111111';
        }

        // 獲取變卦地支和六親
        function getBianGuaInfo(benGuaBinary, yaos, guaGongWuXing) {
            // 構建變卦二進制（注意yaos是從上爻到初爻的順序）
            const bianGuaBinary = yaos.map(yao => {
                if (isDongYao(yao)) {
                    return getYaoProperty(yao) === '1' ? '0' : '1';
                }
                return getYaoProperty(yao);
            }).join('');
            
            // 獲取變卦的地支
            const bianGuaZhi = getZhuangZhi(bianGuaBinary);
            const bianGuaInfo = [];
            
            // 對每個爻位計算（注意要轉換索引）
            for (let i = 0; i < 6; i++) {
                // yaos是從上爻到初爻，所以要轉換索引
                const yaoIndex = 5 - i;  // i=0(初爻)對應yaos[5], i=5(上爻)對應yaos[0]
                
                if (isDongYao(yaos[yaoIndex])) {
                    const zhi = bianGuaZhi[i];  // bianGuaZhi是從初爻到上爻
                    const zhiWuXing = wuXing[zhi];
                    // 重要：變卦的六親要用主卦的卦宮五行來計算
                    const liuQin = getLiuQin(guaGongWuXing, zhiWuXing);
                    bianGuaInfo[i] = {
                        index: i,
                        zhi: zhi,
                        wuXing: zhiWuXing,
                        liuQin: liuQin
                    };
                } else {
                    bianGuaInfo[i] = null;
                }
            }
            
            return bianGuaInfo;
        }

        // 依日干起六獸序（由初爻向上排序）
        // 甲乙起青龍，丙丁起朱雀，戊起勾陳，己起螣蛇，庚辛起白虎，壬癸起玄武
        function getLiuShouOrder(day) {
            if (!day || !day.length) return [0,1,2,3,4,5];
            const gan = day[0];
            const startMap = {
                '甲':0,'乙':0,   // 青龍
                '丙':1,'丁':1,   // 朱雀
                '戊':2,          // 勾陳
                '己':3,          // 螣蛇
                '庚':4,'辛':4,   // 白虎
                '壬':5,'癸':5    // 玄武
            };
            const start = startMap[gan];
            if (start === undefined) return [0,1,2,3,4,5];
            const order = [];
            for (let i = 0; i < 6; i++) order.push((start + i) % 6);
            return order; // 回傳一個 index 陣列：對應 liuShou 的索引，初→上
        }

        function copyPrompt() {
            const el = document.querySelector('.prompt-output');
            const text = el ? el.textContent : '';
            if (!text) { alert('找不到可複製的內容'); return; }
            navigator.clipboard.writeText(text)
              .then(() => alert('Prompt已複製到剪貼板！'))
              .catch(() => alert('複製失敗，請檢查瀏覽器權限'));
        }

        // ===== 數字起卦：共用工具 =====
        const trigramBinaryByIndex = {
          1:'111', // 乾
          2:'011', // 兌
          3:'101', // 離
          4:'001', // 震
          5:'110', // 巽
          6:'010', // 坎
          7:'100', // 艮
          8:'000'  // 坤
        };

        function to8(n){ n = Math.abs(parseInt(n,10)||0); const r = n % 8; return r===0 ? 8 : r; }
        function to6(n){ n = Math.abs(parseInt(n,10)||0); const r = n % 6; return r===0 ? 6 : r; }

        // 從 hour 下拉取時辰地支序號：子=1…亥=12
        function getHourBranchIndex(){
          const hourVal = (document.getElementById('hour')?.value || '');
          const zhi = hourVal.slice(1,2); // 取地支
          const idx = diZhi.indexOf(zhi);
          return idx === -1 ? 1 : (idx + 1);
        }

        // 由「上卦序(1..8)、下卦序(1..8)、動爻位(1=初..6=上)」生成 coinResults 並更新畫面
        function setHexFromTrigramsAndMover(upperIdx, lowerIdx, movePos1to6){
          const upBin  = trigramBinaryByIndex[upperIdx];
          const lowBin = trigramBinaryByIndex[lowerIdx];
          const topDownBits = (upBin + lowBin).split(''); // [上,五,四,三,二,初] 的 1/0

          // 把 top-down bits 轉成 bottom-up coinResults（初到上）
          for(let i=0;i<6;i++){
            const j = 5 - i; // top→down index
            const bit = topDownBits[j];              // '1' or '0'
            const isMoving = (i + 1) === movePos1to6; // 1=初..6=上
            const type = (bit === '1')
              ? (isMoving ? '老陽' : '少陽')
              : (isMoving ? '老陰' : '少陰');
            coinResults[i] = type;

            // 同步到投擲顯示區（coinX-result）
            const span = document.getElementById(`coin${i+1}-result`);
            if (span) span.innerHTML = `<strong>【數起】→ ${type}</strong>`;
          }
        }

        // ===== 方法一：一個數字 + 時辰 =====
        function startByOne(){
          const v = document.getElementById('num-one').value.trim();
          if (!v){ alert('請輸入一個數字'); return; }
          const n = parseInt(v,10);
          const hourIdx = getHourBranchIndex();   // 1..12
          const upperIdx = to8(n);                // 1..8
          const lowerIdx = to8(hourIdx);          // 1..8
          const movePos  = to6(n + hourIdx);      // 1..6（零當六）
          setHexFromTrigramsAndMover(upperIdx, lowerIdx, movePos);
        }

        // ===== 方法二：兩個數字 =====
        function startByTwo(){
          const a = parseInt(document.getElementById('num-two-a').value.trim(),10);
          const b = parseInt(document.getElementById('num-two-b').value.trim(),10);
          if (isNaN(a) || isNaN(b)){ alert('請輸入兩個數字'); return; }
          const upperIdx = to8(a);
          const lowerIdx = to8(b);
          const movePos  = to6(a + b);
          setHexFromTrigramsAndMover(upperIdx, lowerIdx, movePos);
        }

        // ===== 方法三：一組多位數（奇數位=分段法；偶數位=平分法） =====
        function startByMany(){
          const sRaw = document.getElementById('num-many').value.trim();
          const s = (sRaw.match(/\d+/g) || []).join('');
          if (!s){ alert('請輸入數字（可含空格/符號）'); return; }

          const digits = s.split('').map(d=>parseInt(d,10));
          const L = digits.length;

          let upBase, downBase; // 用來求上/下卦的「基數」
          if (L % 2 === 1){
            // 奇位數：分段法（首位 / 其餘）
            upBase = parseInt(s[0],10);
            downBase = parseInt(s.slice(1) || '0',10);
          }else{
            // 偶位數：平分法（前半和 / 後半和）
            const half = L/2;
            upBase   = digits.slice(0, half).reduce((a,b)=>a+b,0);
            downBase = digits.slice(half).reduce((a,b)=>a+b,0);
          }

          const upperIdx = to8(upBase);
          const lowerIdx = to8(downBase);
          const movePos  = to6(digits.reduce((a,b)=>a+b,0)); // 逐位相加
          setHexFromTrigramsAndMover(upperIdx, lowerIdx, movePos);
        }




// —— 1) 安世身（按世所臨地支）——
// 規則：子午→初(1)、丑未→二(2)、寅申→三(3)、卯酉→四(4)、辰戌→五(5)、巳亥→上(6)
// 回傳 1..6（1=初 … 6=上）
function getShiShenPos(benGuaBinary) {
    const benGuaInfo = getGuaInfo(benGuaBinary); // 含 shiYing（1=初 … 6=上）
    const shiPos = benGuaInfo.shiYing[0];        // 世爻位置（1..6）
    const allZhi = getZhuangZhi(benGuaBinary);   // 初→上
    const shiZhi = allZhi[shiPos - 1];

    const map = {
        '子': 1, '午': 1,
        '丑': 2, '未': 2,
        '寅': 3, '申': 3,
        '卯': 4, '酉': 4,
        '辰': 5, '戌': 5,
        '巳': 6, '亥': 6
    };
    return map[shiZhi] || shiPos; // fallback：未知支時用世位
}

        // —— 月卦身（純取支；陰世午→…→亥，陽世子→…→巳；不落某一爻）——
        function getYueGuaShenZhi(benGuaBinary, yaosTopDown) {
          const shiPos = getGuaInfo(benGuaBinary).shiYing[0];           // 1..6（1=初）
          const shiIndexTopDown = 6 - shiPos;                           // 上→初 的索引
          const shiIsYang = (getYaoProperty(yaosTopDown[shiIndexTopDown]) === '1');

          const seqYang = ['子','丑','寅','卯','辰','巳'];
          const seqYin  = ['午','未','申','酉','戌','亥'];
          const zhi = (shiIsYang ? seqYang : seqYin)[shiPos - 1];       // 直取「數到世」嗰個支

          const wx = wuXing[zhi];
          const ggWx = getGuaGongWuXing(getGuaGong(benGuaBinary));
          const liuQin = getLiuQin(ggWx, wx);
          return { zhi, wuXing: wx, liuQin };                           // ⚠️ 不返回爻位
        }


// —— 3) 表格（上→初；含 世/應、世身、月卦身 標註）——
function generateTable() {
  const year = document.getElementById('year').value;
  const month = document.getElementById('month').value;
  const day = document.getElementById('day').value;
  const hour = document.getElementById('hour').value;

  if (coinResults.some(r => r === null)) {
    alert('請先完成六次投擲！');
    return;
  }

  const yaosTopDown = coinResults.slice().reverse(); // [上, 五, 四, 三, 二, 初]
  const benGuaBinary = yaosTopDown.map(yao => getYaoProperty(yao)).join('');
  const benGuaInfo = getGuaInfo(benGuaBinary);

  const bianGuaBinary = yaosTopDown.map(yao =>
    isDongYao(yao) ? (getYaoProperty(yao) === '1' ? '0' : '1') : getYaoProperty(yao)
  ).join('');
  const bianGua = getGuaInfo(bianGuaBinary);

  const shiYing = benGuaInfo.shiYing; // 1=初 … 6=上
  const yaoNamesTD = ['上爻','五爻','四爻','三爻','二爻','初爻']; // 表格（上→初）
  const yaoNamesBU = ['初爻','二爻','三爻','四爻','五爻','上爻']; // 位置（初→上）

  const guaGong = getGuaGong(benGuaBinary);
  const guaGongWuXing = getGuaGongWuXing(guaGong);

  const allZhi = getZhuangZhi(benGuaBinary);                 // 初→上
  const shouOrder = getLiuShouOrder(day);                    // 初→上
  const fuShenList = getFuShen(benGuaBinary, guaGongWuXing); // index=初→上
  const bianInfoList = getBianGuaInfo(benGuaBinary, yaosTopDown, guaGongWuXing);
  const yueGuaShen = getYueGuaShenZhi(benGuaBinary, yaosTopDown); // 只給支/五行/六親
  const shiShenPos = getShiShenPos(benGuaBinary);

  let kongWangZhi = ['戌','亥'];
  if (day.length >= 2) kongWangZhi = getKongWang(day[0], day[1]);

  let tableHTML = `
    <div class="section">
      <h3>完整六爻卦象表</h3>
      <table class="hexagram-table">
        <tr>
          <th>爻位</th>
          <th>伏神</th>
          <th>六獸</th>
          <th>爻象</th>
          <th>地支</th>
          <th>五行</th>
          <th>六親</th>
          <th>世應</th>
          <th>動變</th>
          <th>變卦六親</th>
          <th>空亡</th>
        </tr>
  `;

  for (let i = 0; i < 6; i++) {
    const displayIndex = 5 - i;                 // 映射到 初→上
    const yaoType = yaosTopDown[i];
    const yinYang = getYaoProperty(yaoType) === '1' ? '陽' : '陰';
    const symbolClass = (yinYang === '陽') ? 'yang' : 'yin';
    const rowClass = isDongYao(yaoType) ? 'dong-yao' : '';

    const zhi = allZhi[displayIndex];
    const zhiWuXing = wuXing[zhi];
    const liuQin = getLiuQin(guaGongWuXing, zhiWuXing);

    const shou = liuShou[shouOrder[displayIndex]];
    const isKong = kongWangZhi.includes(zhi);
    const kongClass = isKong ? 'kong-wang' : '';
    const kongText = isKong ? '空' : '';

    const pos1to6 = displayIndex + 1;           // 1=初 … 6=上
    let tags = [];
    if (shiYing.includes(pos1to6)) tags.push(shiYing[0] === pos1to6 ? '世' : '應');
    if (pos1to6 === shiShenPos) {
      if (tags[0] === '世') tags[0] = '世身';
      else tags.push('身');
    }

    const fu = fuShenList.find(fs => fs.index === displayIndex);
    const fuText = fu
      ? `<div class="fu-shen">${fu.liuQin} ${fu.zhi}${fu.wuXing}${kongWangZhi.includes(fu.zhi) ? '(空)' : ''}</div>`
      : '';

    const bian = bianInfoList[displayIndex];
    const bianText = bian
      ? `<div class="bian-info">${bian.liuQin} ${bian.zhi}${bian.wuXing}${kongWangZhi.includes(bian.zhi) ? '(空)' : ''}</div>`
      : '';

    tableHTML += `
      <tr class="${rowClass} ${kongClass}">
        <td><strong>${yaoNamesTD[i]}</strong></td>
        <td>${fuText}</td>
        <td>${shou}</td>
        <td class="yao-line ${symbolClass}">${getYaoSymbol(yaoType)}</td>
        <td>${zhi}</td>
        <td>${zhiWuXing}</td>
        <td>${liuQin}</td>
        <td style="color: red; font-weight: bold;">${tags.join(' ')}</td>
        <td>${isDongYao(yaoType) ? '動' : ''}</td>
        <td>${bianText}</td>
        <td>${kongText}</td>
      </tr>
    `;
  }

  const dongYaoList = [];
  for (let i = 0; i < 6; i++) if (isDongYao(yaosTopDown[i])) dongYaoList.push(yaoNamesTD[i]);
  const guaType = benGuaInfo.type ? `<span class="gua-type">${benGuaInfo.type}</span>` : '';

  tableHTML += `
      </table>
      <div style="margin-top:15px;">
        <p><strong>四柱:</strong> ${year} ${month} ${day} ${hour}</p>
        <p><strong>本卦:</strong> ${benGuaInfo.fullName}${guaType} → <strong>變卦:</strong> ${bianGua.fullName}</p>
        <p><strong>卦宮:</strong> ${guaGong}宮 (${guaGongWuXing}) |
           <strong>世爻:</strong> ${yaoNamesBU[shiYing[0]-1]} |
           <strong>應爻:</strong> ${yaoNamesBU[shiYing[1]-1]} |
           <strong>世身:</strong> ${yaoNamesBU[getShiShenPos(benGuaBinary)-1]} |
           <strong>月卦身:</strong> ${yueGuaShen.zhi}${yueGuaShen.wuXing}（${yueGuaShen.liuQin}）</p>
        <p><strong>動爻:</strong> ${dongYaoList.length ? dongYaoList.join('、') : '無動爻'}</p>
        <p><strong>空亡:</strong> ${kongWangZhi.join('、')}</p>
      </div>
    </div>
  `;

  document.getElementById('hexagram-display').innerHTML = tableHTML;
}



// —— 4) Prompt（上→初；含 世/應、世身、月卦身 摘要）——
function exportPrompt() {
  const year = document.getElementById('year').value;
  const month = document.getElementById('month').value;
  const day = document.getElementById('day').value;
  const hour = document.getElementById('hour').value;
  const question = document.getElementById('question').value;

  if (coinResults.some(result => result === null)) {
    alert('請先完成投擲並生成卦表！');
    return;
  }

  const yaosTopDown = coinResults.slice().reverse(); // [上, 五, 四, 三, 二, 初]
  const benGuaBinary = yaosTopDown.map(yao => getYaoProperty(yao)).join('');
  const benGuaInfo = getGuaInfo(benGuaBinary);

  const bianGuaBinary = yaosTopDown.map(yao => {
    if (isDongYao(yao)) return getYaoProperty(yao) === '1' ? '0' : '1';
    return getYaoProperty(yao);
  }).join('');
  const bianGuaInfo = getGuaInfo(bianGuaBinary);

  const shiYing = benGuaInfo.shiYing; // 1=初 … 6=上
  const yaoNamesTD = ['上爻','五爻','四爻','三爻','二爻','初爻']; // 行內（上→初）
  const yaoNamesBU = ['初爻','二爻','三爻','四爻','五爻','上爻']; // 標頭位置（初→上）

  const guaGong = getGuaGong(benGuaBinary);
  const guaGongWuXing = getGuaGongWuXing(guaGong);

  const shouOrder = getLiuShouOrder(day);           // 初→上
  const allZhi = getZhuangZhi(benGuaBinary);        // 初→上
  const fuShenList = getFuShen(benGuaBinary, guaGongWuXing);
  const bianGuaInfoList = getBianGuaInfo(benGuaBinary, yaosTopDown, guaGongWuXing);
  const yueGuaShen = getYueGuaShenZhi(benGuaBinary, yaosTopDown);
  const shiShenPos = getShiShenPos(benGuaBinary);

  let kongWangZhi = ['戌', '亥'];
  if (day.length >= 2) {
    const dayGan = day[0], dayZhi = day[1];
    kongWangZhi = getKongWang(dayGan, dayZhi);
  }

  let dongYaoList = [];
  let yaoDetails = '';

  for (let i = 0; i < 6; i++) {
    const displayIndex = 5 - i; // 映射到 初→上
    const yaoType = yaosTopDown[i];
    const isDong = isDongYao(yaoType);
    if (isDong) dongYaoList.push(yaoNamesTD[i]);

    const zhi = allZhi[displayIndex];
    const zhiWuXing = wuXing[zhi];
    const liuQin = getLiuQin(guaGongWuXing, zhiWuXing);

    const shou = liuShou[shouOrder[displayIndex]];
    const isKongWang = kongWangZhi.includes(zhi);
    const status = `${isDong ? '動' : '靜'}${isKongWang ? '空' : ''}`;

    const pos1to6 = displayIndex + 1;  // 1=初 … 6=上
    let mark = '';
    if (shiYing.includes(pos1to6)) mark = (shiYing[0] === pos1to6 ? '世' : '應');
    if (pos1to6 === shiShenPos) {
      if (mark === '世') mark = '世身';
      else mark = mark ? (mark + ' 身') : '身';
    }
    // 月卦身不落某一爻，故不在行內標註「卦身」

    const fuShen = fuShenList.find(fs => fs.index === displayIndex);
    const fuShenText = fuShen ? ` 伏${fuShen.liuQin}${fuShen.zhi}${fuShen.wuXing}` : '';

    const bianInfo = bianGuaInfoList[displayIndex];
    const bianText = bianInfo ? ` → 變${bianInfo.liuQin}${bianInfo.zhi}${bianInfo.wuXing}` : '';

    yaoDetails += `${yaoNamesTD[i]}：${getYaoSymbol(yaoType)} ${shou} ${liuQin}${zhi}${zhiWuXing} ${mark} (${status})${fuShenText}${bianText}\n`;
  }

  const guaTypeText = benGuaInfo.type ? `（${benGuaInfo.type}）` : '';
  const prompt = `請幫我分析以下六爻卦象：

【問事內容】
${question}

【起卦時間】
四柱：${year} ${month} ${day} ${hour}
空亡：${kongWangZhi.join('、')}

【卦象信息】
卦宮：${guaGong}宮 (${guaGongWuXing})
本卦：${benGuaInfo.fullName}${guaTypeText}
變卦：${bianGuaInfo.fullName}
世爻：${yaoNamesBU[shiYing[0] - 1]}
應爻：${yaoNamesBU[shiYing[1] - 1]}
世身：${yaoNamesBU[shiShenPos - 1]}
月卦身：${yueGuaShen.liuQin} ${yueGuaShen.zhi}${yueGuaShen.wuXing}

【完整爻象】
${yaoDetails}
動爻：${dongYaoList.length > 0 ? dongYaoList.join('、') : '無動爻'}

【投擲記錄】
上爻：${coinResults[5]}
五爻：${coinResults[4]}
四爻：${coinResults[3]}
三爻：${coinResults[2]}
二爻：${coinResults[1]}  
初爻：${coinResults[0]}

請根據六爻理論，從以下角度進行詳細分析：
1. 卦象基本含義與卦宮分析${guaTypeText ? '（注意此卦為' + benGuaInfo.type + '）' : ''}
2. 世應關係與用神確定
3. 動爻分析與變化意義
4. 六親生克關係（包括伏神與飛神的關係）
5. 空亡對卦象的影響
6. 世身與月卦身的作用與差異
7. 結合問事內容的具體判斷
8. 吉凶預測及行動建議
9. 時間應期判斷

請提供準確詳細的六爻分析。`;

  document.getElementById('prompt-display').innerHTML = `
      <div class="section">
          <h3>AI分析Prompt（完整版）</h3>
          <div class="prompt-output">${prompt}</div>
          <button class="copy-btn" onclick="copyPrompt()">複製Prompt</button>
      </div>
  `;
}





    </script>
</body>
</html>